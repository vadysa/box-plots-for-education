{"openapi":"3.0.2","info":{"title":"Aggregation service API","description":"Сервиса агрегации данных детекции","version":"v1"},"paths":{"/version":{"get":{"summary":"Возвращает текущую версию сервиса","description":"Возвращает текущую версию сервиса","operationId":"get_version_version_get","responses":{"200":{"description":"Текущая версия сервиса","content":{"text/plain":{"schema":{"type":"string"}}}}}}},"/health":{"get":{"summary":"Get Health","description":"Возвращает статус проверки доступности сервиса","operationId":"get_Health_health_get","responses":{"200":{"description":"Статус проверки доступности сервиса","content":{"application/json":{"schema":{}}}}}}},"/state/down_count/":{"get":{"summary":"Get Down Count","description":"Возвращает счетчик отказов работоспособности сервиса с момента запуска","operationId":"get_down_count_state_down_count__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/state/reset/":{"put":{"summary":"Put Reset","description":"Сбрасывает состояние алгоритма агрегации","operationId":"put_reset_state_reset__put","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/data/aggregated/":{"put":{"summary":"Put Aggregated Data","description":"Получить агрегированные данные по информации со всех камер","operationId":"put_aggregated_data_data_aggregated__put","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DetectionResult"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/config/horizon_line/":{"put":{"summary":"Put Config Horizon Line","description":"Задать линию горизонта","operationId":"put_config_horizon_line_config_horizon_line__put","requestBody":{"content":{"application/json":{"schema":{"title":"Horizon Lines","type":"object","additionalProperties":{"$ref":"#/components/schemas/LineF"}}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/aggregation/get_config":{"get":{"summary":"Get Config","description":"Возвращает конфигурацию камер","operationId":"get_config_api_v1_aggregation_get_config_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AggregationConfiguration"}}}}}}},"/api/v1/aggregation/set_config":{"post":{"summary":"Set Config","description":"Задает параметры конфигурации камер, принимает значения осадков для перенастройки конфигурации.","operationId":"set_config_api_v1_aggregation_set_config_post","parameters":[{"required":false,"schema":{"title":"Ship Draft","type":"number","default":0.0},"name":"ship_draft","in":"query"}],"requestBody":{"content":{"application/json":{"schema":{"title":"Config","allOf":[{"$ref":"#/components/schemas/AggregationConfiguration"}],"default":{"ConfigurationCamera":[{"name":"CAM1","static":false,"Position":{"Ox":14.0,"Oy":0.0,"Oz":0.0},"Orientation":{"Ox":0.0,"Oy":2.2,"Oz":0.5},"draft_installation":0.0,"additional_shift":0.15,"horizon_distance":5000.0,"compensation_at_horizon_line":5,"HorizonLineROI":{"roi_starter_center":490,"radius_roi":50,"min_roi":390,"max_roi":590}},{"name":"CAM2","static":false,"Position":{"Ox":14.0,"Oy":0.0,"Oz":0.0},"Orientation":{"Ox":0.0,"Oy":2.0,"Oz":0.3},"draft_installation":0.0,"additional_shift":0.1,"horizon_distance":5000.0,"compensation_at_horizon_line":5,"HorizonLineROI":{"roi_starter_center":470,"radius_roi":50,"min_roi":370,"max_roi":570}},{"name":"CAM3","static":false,"Position":{"Ox":14.0,"Oy":0.0,"Oz":0.0},"Orientation":{"Ox":0.0,"Oy":1.5,"Oz":-0.5},"draft_installation":0.0,"additional_shift":0.0,"horizon_distance":5000.0,"compensation_at_horizon_line":5,"HorizonLineROI":{"roi_starter_center":460,"radius_roi":50,"min_roi":360,"max_roi":560}},{"name":"CAM4","static":false,"Position":{"Ox":14.0,"Oy":0.0,"Oz":0.0},"Orientation":{"Ox":0.0,"Oy":1.2,"Oz":-0.4},"draft_installation":0.0,"additional_shift":0.2,"horizon_distance":5000.0,"compensation_at_horizon_line":5,"HorizonLineROI":{"roi_starter_center":520,"radius_roi":50,"min_roi":420,"max_roi":620}},{"name":"CAM5","static":false,"Position":{"Ox":12.0,"Oy":0.0,"Oz":0.0},"Orientation":{"Ox":0.0,"Oy":2.3,"Oz":-0.2},"draft_installation":0.0,"additional_shift":0.2,"horizon_distance":5000.0,"compensation_at_horizon_line":5,"HorizonLineROI":{"roi_starter_center":490,"radius_roi":50,"min_roi":390,"max_roi":590}},{"name":"CAM6","static":false,"Position":{"Ox":14.0,"Oy":0.0,"Oz":0.0},"Orientation":{"Ox":0.0,"Oy":2.0,"Oz":-0.7},"draft_installation":0.0,"additional_shift":0.1,"horizon_distance":5000.0,"compensation_at_horizon_line":5,"HorizonLineROI":{"roi_starter_center":470,"radius_roi":50,"min_roi":370,"max_roi":570}},{"name":"CAM8","static":false,"Position":{"Ox":14.0,"Oy":0.0,"Oz":0.0},"Orientation":{"Ox":0.0,"Oy":2.4,"Oz":1.5},"draft_installation":0.0,"additional_shift":0.15,"horizon_distance":5000.0,"compensation_at_horizon_line":5,"HorizonLineROI":{"roi_starter_center":480,"radius_roi":50,"min_roi":380,"max_roi":580}},{"name":"CAM9","static":false,"Position":{"Ox":14.0,"Oy":0.0,"Oz":0.0},"Orientation":{"Ox":0.0,"Oy":1.1,"Oz":0.7},"draft_installation":0.0,"additional_shift":0.2,"horizon_distance":5000.0,"compensation_at_horizon_line":8,"HorizonLineROI":{"roi_starter_center":510,"radius_roi":50,"min_roi":410,"max_roi":610}}],"FeaturesCamera":{"frame_w":1920,"frame_h":1080,"view_angle_v":37.0,"view_angle_h":60.0,"f_mm":4.773,"matrix_cell_size_mm":0.0029,"segment_count":15,"ship_draft":0.0}}}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"AggregationConfiguration":{"title":"AggregationConfiguration","required":["ConfigurationCamera","FeaturesCamera"],"type":"object","properties":{"ConfigurationCamera":{"title":"Configurationcamera","type":"array","items":{"$ref":"#/components/schemas/ConfigurationCamera"}},"FeaturesCamera":{"$ref":"#/components/schemas/FeaturesCamera"}}},"ConfigurationCamera":{"title":"ConfigurationCamera","required":["name","static","Position","Orientation","draft_installation","additional_shift","horizon_distance","compensation_at_horizon_line","HorizonLineROI"],"type":"object","properties":{"name":{"title":"Name","type":"string"},"static":{"title":"Static","type":"boolean"},"Position":{"$ref":"#/components/schemas/Position"},"Orientation":{"$ref":"#/components/schemas/Orientation"},"draft_installation":{"title":"Draft Installation","type":"number"},"additional_shift":{"title":"Additional Shift","type":"number"},"horizon_distance":{"title":"Horizon Distance","type":"number"},"compensation_at_horizon_line":{"title":"Compensation At Horizon Line","type":"integer"},"HorizonLineROI":{"$ref":"#/components/schemas/HorizonLineROI"}}},"DetectionResult":{"title":"DetectionResult","required":["detection_result"],"type":"object","properties":{"detection_result":{"title":"Detection Result","type":"object","additionalProperties":{"$ref":"#/components/schemas/ImageDetections"}},"sequence_number":{"title":"Sequence Number","type":"integer"}},"description":"Результат детекции судов с разных камер, поступает от ядра обработки.\nНастедуется от BaseModel для валидации типов данных."},"FeaturesCamera":{"title":"FeaturesCamera","required":["frame_w","frame_h","view_angle_v","view_angle_h","f_mm","matrix_cell_size_mm","segment_count"],"type":"object","properties":{"frame_w":{"title":"Frame W","type":"integer"},"frame_h":{"title":"Frame H","type":"integer"},"view_angle_v":{"title":"View Angle V","type":"number"},"view_angle_h":{"title":"View Angle H","type":"number"},"f_mm":{"title":"F Mm","type":"number"},"matrix_cell_size_mm":{"title":"Matrix Cell Size Mm","type":"number"},"segment_count":{"title":"Segment Count","type":"integer"},"ship_draft":{"title":"Ship Draft","type":"number","default":0}}},"HTTPValidationError":{"title":"HTTPValidationError","type":"object","properties":{"detail":{"title":"Detail","type":"array","items":{"$ref":"#/components/schemas/ValidationError"}}}},"HorizonLineROI":{"title":"HorizonLineROI","required":["roi_starter_center","radius_roi","min_roi","max_roi"],"type":"object","properties":{"roi_starter_center":{"title":"Roi Starter Center","type":"integer"},"radius_roi":{"title":"Radius Roi","type":"integer"},"min_roi":{"title":"Min Roi","type":"integer"},"max_roi":{"title":"Max Roi","type":"integer"}}},"ImageDetections":{"title":"ImageDetections","type":"object","properties":{"ships":{"title":"Ships","type":"array","items":{"$ref":"#/components/schemas/ShipDetection"}}}},"LineF":{"title":"LineF","required":["x1","x2","y1","y2"],"type":"object","properties":{"x1":{"title":"X1","type":"number"},"x2":{"title":"X2","type":"number"},"y1":{"title":"Y1","type":"number"},"y2":{"title":"Y2","type":"number"}}},"Orientation":{"title":"Orientation","required":["Ox","Oy","Oz"],"type":"object","properties":{"Ox":{"title":"Ox","type":"number"},"Oy":{"title":"Oy","type":"number"},"Oz":{"title":"Oz","type":"number"}}},"Position":{"title":"Position","required":["Ox","Oy","Oz"],"type":"object","properties":{"Ox":{"title":"Ox","type":"number"},"Oy":{"title":"Oy","type":"number"},"Oz":{"title":"Oz","type":"number"}}},"RectangleF":{"title":"RectangleF","required":["xtl","ytl","w","h"],"type":"object","properties":{"xtl":{"title":"Xtl","type":"number"},"ytl":{"title":"Ytl","type":"number"},"w":{"title":"W","type":"number"},"h":{"title":"H","type":"number"}}},"ShipDetection":{"title":"ShipDetection","required":["position","object_confidence","class_confidence","ship_type","features"],"type":"object","properties":{"position":{"$ref":"#/components/schemas/RectangleF"},"object_confidence":{"title":"Object Confidence","type":"number"},"class_confidence":{"title":"Class Confidence","type":"number"},"ship_type":{"title":"Ship Type","type":"string"},"features":{"title":"Features","type":"string"}}},"ValidationError":{"title":"ValidationError","required":["loc","msg","type"],"type":"object","properties":{"loc":{"title":"Location","type":"array","items":{"type":"string"}},"msg":{"title":"Message","type":"string"},"type":{"title":"Error Type","type":"string"}}}}}}
